\documentclass[11pt,a4paper]{article}

\usepackage{hyperref}
\hypersetup{
  bookmarks=true,
  pdftitle={The Twirly Manual},
  pdfauthor={Mark Aylett},
  colorlinks=true,
  linkcolor=blue,
  citecolor=blue,
  filecolor=blue,
  urlcolor=blue
}

\usepackage{float}
\usepackage{graphicx}
\usepackage{listings}
\usepackage[titletoc,title,toc]{appendix}
\usepackage[acronym,toc,xindy]{glossaries}
\makeglossaries

\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}

\newcommand{\scltd}{Swirly Cloud Limited\cite{swirlycloud:www}}
\newcommand{\scorg}{Swirly Cloud\cite{swirlycloud:github}}
\newcommand{\twirly}{Twirly\cite{twirly}}
\newcommand{\s}{\textsterling}

\newacronym{api}{API}{Application Programming Interface}
\newacronym{bbo}{BBO}{Best Bid and Offer}
\newacronym{cpu}{CPU}{Central Processing Unit}
\newacronym{ecn}{ECN}{Electronic Communication Network}
\newacronym{json}{JSON}{Java-Script Object Notation}
\newacronym{hft}{HFT}{High-Frequency Trading}
\newacronym{http}{HTTP}{Hyper-Text Transfer Protocol}
\newacronym{ip}{IP}{Intellectual Property}
\newacronym{mis}{MIS}{Market Information Services}
\newacronym{mtm}{MTM}{Mark To Market}
\newacronym{poc}{POC}{Proof Of Concept}
\newacronym{rest}{Rest}{Representational State Transfer}
\newacronym{tco}{TCO}{Total Cost of Ownership}
\newacronym{tvm}{TVM}{Time Value of Money}
\newacronym{tob}{TOB}{Top Of Book}
\newacronym{ui}{UI}{User Interface}
\newacronym{vwap}{VWAP}{Volume Weighted Average Price}
\newacronym{www}{WWW}{World Wide Web}

\newacronym{kg}{KG}{Kilogram}

\newglossaryentry{appengine}{name={App Engine}, description={application services running on
    Google's Cloud platform}}

\newglossaryentry{arbitrage}{name={arbitrage}, description={the simultaneous purchase and sale on
    different markets, of the same or equivalent financial instruments to profit from price or
    currency differentials}}

\newglossaryentry{asset}{name={asset}, description={an item of value}}

\newglossaryentry{auction}{name={auction}, description={a market where goods or services are sold to
    the highest bidder}}

\newglossaryentry{bid}{name={bid}, description={the price and quantity at which a market participant
    is willing to buy}}

\newglossaryentry{bitcoin}{name={bitcoin}, description={an electronic currency that allows users to
    transact online without a financial intermediary}}

\newglossaryentry{cloud}{name={Cloud}, description={a network of remote servers hosted on the
    Internet to store, manage, and process data}}

\newglossaryentry{contract}{name={contract}, description={a specification that stipulates the terms
    and conditions of sale}}

\newglossaryentry{exchange}{name={exchange}, description={a place where buyers and sellers meet to
    exchange goods or services}}

\newglossaryentry{execution}{name={execution}, description={a transaction that occurs as an order
    transitions through a workflow}}

\newglossaryentry{expiry date}{name={expiry date}, description={the last date that a contract can be
    traded on a specific market}}

\newglossaryentry{farm gate price}{name={farm gate price}, description={the net price of an
    agricultural product when it leaves the farm, after marketing costs have been deducted}}

\newglossaryentry{given}{name={given}, description={when the taker hits the bid}}

\newglossaryentry{price-level}{name={price-level}, description={a price level is the sum of all
    orders in the book with the same price}}

\newglossaryentry{liquid market}{name={liquid market}, description={the ability of a market to
    accept large transactions with minimal impact on price stability}}

\newglossaryentry{liquidity}{name={liquidity}, description={refers the bids and offers available in
    a market}}

\newglossaryentry{lot}{name={lot}, description={a unit of measure that represents the smallest
    amount that can be bought or sold}}

\newglossaryentry{maker}{name={maker}, description={passive buyer or seller that receives the spread}}

\newglossaryentry{market}{name={market}, description={a place where buyers and sellers come together
    to exchange goods or services}}

\newglossaryentry{market-maker}{name={market-maker}, description={a market-maker quotes both bids
    and offers, aiming to profit from the bid-offer spread}}

\newglossaryentry{market order}{name={market order}, description={an order to buy or sell at the
    current market price}}

\newglossaryentry{market-place}{name={market-place}, description={a venue comprising many markets}}

\newglossaryentry{matching engine}{name={matching engine}, description={the software component in a
    trading application responsible for matching buy and sell orders to form a trade}}

\newglossaryentry{microservice}{name={microservice}, description={a small, independent and
    language-agnostic service that does one thing and does it well}}

\newglossaryentry{order-book}{name={order-book}, description={the software component in a trading
    application responsible for managing resting orders in a two-sided market}}

\newglossaryentry{offer}{name={offer}, description={the price and quantity at which a market
    partipant is willing to sell}}

\newglossaryentry{order}{name={order}, description={an instruction to buy or sell goods or
    services}}

\newglossaryentry{paid}{name={paid}, description={when the taker lifts the offer}}

\newglossaryentry{servlet}{name={servlet}, description={a software component in a Web server that
    responds to client requests}}

\newglossaryentry{restful}{name={restful}, description={a software architecture for building
    scalable web services}}

\newglossaryentry{resting-order}{name={resting-order}, description={an order that is sitting in the
    order-book waiting to be matched}}

\newglossaryentry{settlement date}{name={settlement date}, description={the date on which a trade is
    settled between counter-parties}}

\newglossaryentry{spread}{name={spread}, description={the difference between the best bid and
    offer}}

\newglossaryentry{taker}{name={taker}, description={aggressive buyer or seller that pays the spread}}

\newglossaryentry{tick}{name={tick}, description={a unit of measure that represents the smallest
    price movement}}

\newglossaryentry{trade}{name={trade}, description={the exchange of goods or services between
    counter-parties}}

\newglossaryentry{trade date}{name={trade date}, description={the date on which a trade takes place}}

\newglossaryentry{unzip}{name={unzip}, description={a program used to extract compressed files in a
    ZIP archive}}

\newglossaryentry{volume}{name={volume}, description={total quantity}}

\newglossaryentry{warehouse}{name={warehouse}, description={a secure facility that
    safeguards the quality and quantity of stored commodities}}

\newglossaryentry{warehouse receipt}{name={warehouse receipt}, description={a receipt that
    guarantees the existence and availability of a commodity of a particular type, quality, and
    quantity in a storage facility}}

\newglossaryentry{web}{name={Web}, description={the World Wide Web}}

\glsaddall

\begin{document}

\title{The Twirly Manual}
\author{Mark Aylett}
\date{\today\\Version 0.4}
\maketitle

\tableofcontents

\section{Smallholders}

A smallholding is a small farm. There are an estimated 500 million smallholder farms in the world,
supporting almost 2 billion people. These farms produce a range of commodities that pass through
complex value-chains to prepare them for international \glspl{market}.

Smallholder farms sit at the base of a pyramidal structure that culminates with a commodities
``\gls{exchange}'' at its apex. Commodity \glspl{exchange} are highly efficient wholesale
\glspl{market} where buyers and sellers meet. There are at least ten such \glspl{exchange} in Africa
alone. Traditional export commodities in Africa, such as cocoa, coffee and cotton, are projected to
increase from \$8 billion in 2000 to \$10.5 billion in 2030 (in constant US dollars).

\subsection{Banks and Warehouses}

A ``bank'' can be defined as, ``a stock of something available for use when required.'' A
traditional high-street bank, for example, is a place where customers can store their money for
safekeeping. Most banks offer online banking services that allow customers to view their
transactions, make payments, and transfer money between accounts. Interest may be payed on these
deposits due to the \gls{tvm}.

Banks need not be restricted to money. Some high-street banks also offer safety deposit boxes, in
which customers can store their valuables such as documents and jewellery. This can be extended
further to other kinds of assets.

If we think of a bank as a secure storage facility, then similarities between banks and
\glspl{warehouse} start to emerge. Smallholders, for example, can either sell their produce at the
``farm gate'' or store it in a \gls{warehouse}, in the same way that we can either spend our money
immediately or save it in a bank.

\Glspl{warehouse} issue \glspl{warehouse receipt} to smallholders when they deposit their produce.
Depositing money in a bank is similar conceptually to storing commodities in a \gls{warehouse}:

\begin{itemize}
\item the smallholder deposits their produce in a \gls{warehouse};
\item the \glspl{warehouse} verifies the quality and quantity of the produce and issues a
  \gls{warehouse receipt};
\item the \glspl{warehouse} charges for safe storage of the produce (the cost of carry);
\item the \glspl{warehouse receipt} can be used as collateral for loans;
\item the \glspl{warehouse receipt} can be traded (assuming they are transferable);
\item the \glspl{warehouse receipt} entitles the holder to withdraw produce from the \gls{warehouse}.
\end{itemize}

The advantage of this system is that it increases bargaining power of smallholders; if they don't
like the price they're offered at the farm gate, they can drive their produce to the nearest
\gls{warehouse}, store it there until they receive a better offer, and still receive immediate
``payment'' in the form of a loan.

\section{Mission Statement}

Smallholders can acheive economies of scale by pooling their resources within cooperatives or
farmers' unions. Collectives, such as these, allow farmers to focus on their core business, rather
than marketing and sales, which reduces their vulnerability to price exploitation by local
traders. These same principles can be applied to technology.

\scorg{} aims to promote fairnness across the value-chain, by delivering electronic trading
technology into the hands of all \gls{market}-participants, so that they can benefit from improved
transparency, competition, \gls{market} information and pricing.

\section{Electronic Trading}

Many of us routinely use online retailers, auctions, and price comparison websites to buy or sell
goods electronically. In this section, we will see how the same principles apply to trading
platforms that drive wholesale \glspl{market} and commodity \glspl{exchange}.

Coffee is the most popular drink in the world with over 400 billion cups consumed each year. Coffee
production begins on coffee farms, where coffee ``cherries'' are picked from trees. The cherries may
be harvested mechanically or by hand, depending on the size of the farm. Mills are then used to turn
the cherry crop into beans. Coffee beans are exported around the world for retail consumption.

A retail consumer in the UK might decide to purchase coffee beans direct from an online
retailer. Suppose that an online retailer called ``eShop'' in selling coffee beans at \s10.00 per
bag, and they currently have 12 bags in stock. We can depict this as follows:

\vspace{5mm}
\begin{tabular}{rr}
\multicolumn{2}{c}{eShop Coffee Beans}\\
Offer Price&Offer Lots\\
\hline
\texttt{10.00}&\texttt{12}\\
\end{tabular}
\vspace{5mm}

Each ``\gls{lot}'' in this example represents a large bag of Coffee Beans. (We are being
deliberately vague at this stage about the exact type and quality of the beans.) If we decide to buy
5 of the 12 \glspl{lot} on ``\gls{offer}'', then only 7 will remain. The online retailer may then,
rather unscrupulously, decide to raise the price if they believe their supply outstrips demand:

\vspace{5mm}
\begin{tabular}{rr}
\multicolumn{2}{c}{eShop Coffee Beans}\\
Offer Price&Offer Lots\\
\hline
\texttt{10.50}&\texttt{7}\\
\end{tabular}
\vspace{5mm}

This price is presumably non-negotiable, so we have to either ``take'' it or leave it. But what if
we could negotiate, or ``\gls{bid}'' for the remaining \glspl{lot}? You would then have a system
similar to an online ``\gls{auction}'', such as eBay\cite{ebay}, where the \gls{offer} of \s10.50 is
effectively the ``Buy Now'' price. Let's say we place a \gls{bid} to buy 3 more \glspl{lot} of eShop
Coffee Beans at \s10.20:

\vspace{5mm}
\begin{tabular}{rrrrr}
\multicolumn{5}{c}{eShop Coffee Beans}\\
Bid Lots&Bid Price&Spread&Offer Price&Offer Lots\\
\hline
\texttt{3}&\texttt{10.20}&\texttt{0.30}&\texttt{10.50}&\texttt{7}\\
\end{tabular}
\vspace{5mm}

There are now two sides of the \gls{market}: the \gls{bid}- and \gls{offer}-side. The difference
between the \gls{bid} and \gls{offer} price is 30 pence, which is known as the ``\gls{spread}''. In
an online \gls{auction}, another buyer may compete by raising the ``best'' \gls{bid} to ``buy 2
\glspl{lot} at \s10.30'':

\vspace{5mm}
\begin{tabular}{r|rrrrr}
\multicolumn{6}{c}{eShop Coffee Beans}\\
Level&Bid Lots&Bid Price&Spread&Offer Price&Offer Lots\\
\hline
\texttt{1}&\texttt{2}&\texttt{10.30}&\texttt{0.20}&\texttt{10.50}&\texttt{7}\\
\texttt{2}&\texttt{3}&\texttt{10.20}&\texttt{-}&\texttt{-}&\texttt{-}\\
\end{tabular}
\vspace{5mm}

The \gls{bid}-side of the \gls{market} now has two ``\glspl{price-level}'', while the
\gls{offer}-side has just one. A collection of \glspl{order} organised by side and \gls{price-level}
in this way is known as an ``\gls{order-book}''. The best \gls{price-level} on each side of the
\gls{order-book} is \gls{tob}.

Our \gls{order} is said to be ``resting'' at the second \gls{price-level}, beneath \gls{tob}. The
\gls{spread} on the first \gls{price-level} has now been reduced to 20 pence. (There is no
\gls{spread} on the second level, because there is no \gls{offer} at this level.)

Note also at this point that the average price the seller can expect to receive for 5 of the 7
\glspl{lot} they are offering is \s10.24:

\[
\frac{1}{n}\sum_{i=1}^{n}p_iq_i = \frac{2\times10.30+3\times10.20}{5} = 10.24
\]

Where $p$ is price, $q$ is \glspl{lot}, and $n$ is total \glspl{lot} (or ``\gls{volume}''). This is
known as the \gls{vwap}.

If this new buyer then decides to ``revise'' their \gls{bid} with a more ``aggressive'' price of
\s10.50, then their \gls{bid} will ``cross the \gls{spread}'' and match the \gls{offer} to create a
trade, which will reduce the remaining supply down to 5 \glspl{lot}. The buyer effectively decided
to ``buy now''. The \gls{offer} of \s10.20 will once again rise to be \gls{tob}:

\vspace{5mm}
\begin{tabular}{r|rrrrr}
\multicolumn{6}{c}{eShop Coffee Beans}\\
Level&Bid Lots&Bid Price&Spread&Offer Price&Offer Lots\\
\hline
\texttt{1}&\texttt{3}&\texttt{10.20}&\texttt{0.30}&\texttt{10.50}&\texttt{5}\\
\texttt{2}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{-}\\
\end{tabular}
\vspace{5mm}

All manner of goods can be sold in an online \gls{auction}. Oftentimes, the items on sale are one of
a kind. If would be difficult, for example, to \gls{offer} many second-hand bicycles of the exact
same specification, so each would have to be sold separately in its own \gls{market}.

It is interesting to contrast this idea of an online \gls{auction} with a price-comparison
website. Perhaps, as prospective buyers, we're interested in finding the best price for the latest
smart phone:

\vspace{5mm}
\begin{tabular}{r|rrrrr}
\multicolumn{6}{c}{Smart Phone Model XYZ}\\
Level&Bid Lots&Bid Price&Spread&Offer Price&Offer Lots\\
\hline
\texttt{1}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{419.99}&\texttt{5}\\
\texttt{2}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{429.99}&\texttt{12}\\
\texttt{3}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{449.99}&\texttt{20}\\
\end{tabular}
\vspace{5mm}

Here there are 3 \glspl{price-level} in this \gls{order-book}, and we can see that, unsurprisingly,
more smart phones are available at a higher prices. An \gls{order-book} is slightly different to a
price comparison website, however, because an \gls{order-book} aggregates \glspl{order}
(\glspl{offer} in this case) at each \gls{price-level}, rather than by each supplier. The 20
\glspl{lot} available at the third \gls{price-level}, for example, may comprise \glspl{order} from
many suppliers, so attempting to take all 20 \glspl{lot} may result in trades with more than one
supplier.

We could use this same system to compare prices from coffee bean suppliers, but we'd need to be more
specific about the exact type and quality of the beans, and how and when they would be
delivered. This information would form the basis of a ``\gls{contract}'':

\vspace{5mm}
\begin{tabular}{r|rrrrr}
\multicolumn{6}{c}{Aribica Coffee Beans per Kilo}\\
\multicolumn{6}{c}{September 2015}\\
Level&Bid Lots&Bid Price&Spread&Offer Price&Offer Lots\\
\hline
\texttt{1}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{10.50}&\texttt{5}\\
\texttt{2}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{10.60}&\texttt{12}\\
\texttt{3}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{10.80}&\texttt{25}\\
\end{tabular}
\vspace{5mm}

If we now combine this notion of an online \gls{auction} with a price comparison website, then we
end up with something much more reminiscent of a wholesale \gls{market} on an \gls{exchange}, where
there are many active buyers and sellers:

\vspace{5mm}
\begin{tabular}{r|rrrrr}
\multicolumn{6}{c}{Aribica Coffee Beans per Kilo}\\
\multicolumn{6}{c}{September 2015}\\
Level&Bid Lots&Bid Price&Spread&Offer Price&Offer Lots\\
\hline
\texttt{1}&\texttt{10}&\texttt{10.40}&\texttt{0.10}&\texttt{10.50}&\texttt{5}\\
\texttt{2}&\texttt{15}&\texttt{10.25}&\texttt{0.35}&\texttt{10.60}&\texttt{12}\\
\texttt{3}&\texttt{-}&\texttt{-}&\texttt{-}&\texttt{10.80}&\texttt{25}\\
\end{tabular}
\vspace{5mm}

A larger number of \gls{market} participants generally helps to improve the \gls{market}'s
efficiency and stability. This is known as a ``\gls{liquid market}''. \Gls{market} participants
would typically enter electronic \glspl{order} via \gls{ui} similar to the following:

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{orderentry.eps}
\caption{Order Entry}
\end{figure}

Financial organisations use such systems to trade a wide range of products spanning different
\gls{asset}-classes.

In this section, we've seen how \glspl{order-book} can represent different kinds of
\gls{market-place}, including online \glspl{auction}, price comparison websites, and wholesale
\glspl{market}.

If we can combine the generality of \glspl{order-book} with the pervasiveness of mobile and
\gls{web} technologies, then we can truely build compelling solutions that benefit the entire
community from smallholder to \gls{exchange} trader.

\subsection{Settlement}

When we agree a trade with a counter-party, we expose ourselves to ``counter-party risk'', meaning
that the counter-party may default on their obligations under the terms of the contract. The level
of risk depends on many factors, including the credit-worthiness of the counter-party, the size of
the contract, and the time until the goods or services are delivered.

Who we trade with will, at least in part, be determined by the likely-hood that the counter-party
will honour the agreement, and the impact to our business if they don't.

An online retailer failing to deliver a kilo of coffee beans is one thing, but consider a
multi-million dollar infrastructure project that depends on delivery of a raw material at some
future date. As the project manager, it may be in your interest to agree the price upfront for
budgeting purposes and to avoid exposure to price risk (the risk that market prices will move
against you), but it may not be economical or even feasible to take delivery of the material upfront
and store it securely until it is required.

If you arrange with a counter-party to deliver the raw material in the future, then you are exposed
to the risk that this counter-party will default, which could potentially jeopardise the entire
project. You can either accept this risk or try to manage it.

There a few options for managing risk:

\begin{itemize}
\item pay on delivery;
\item verify credit-worthiness;
\item offset the risk;
\item hold collateral or a deposit.
\end{itemize}

\subsection{Infrastructure}

Large online retailers and tech companies have invested heavily in technologies, such as
Google's\cite{google} BigTable\cite{bigtable}, that can cope with Internet-scale workloads, and they
are providing access to their global storage and compute as a managed service (the \gls{cloud}). The
landscape of modern software development has fundamentally changed as a consequence.

The beauty of \gls{cloud} computing is that we only pay for what we use, so we don't need to invest
our capital on infrastructure and additional capacity for future growth. The \gls{cloud} also
simplifies maintenance, operations, disaster recovery and security, so that we can focus our efforts
on writing great software.

\twirly{} has been designed from the ground-up to run efficiently in the \gls{cloud} with limited
resources.  It draws on lessons learned from years spent building electronic trading applications,
and adapts their best ideas for the \gls{cloud}. The \gls{order-book} at the heart of our
application has been developed using \gls{hft} techniques, so that we can minimise latency.

We deliberately develop and test our system with very limited resource quotas, so that we remain
focused on our bottom line. We have also taken care to avoid vendor lock-in, by ensuring that our
core application only uses open standards and technologies. This gives us the option to target
different application containers, run on dedicated infrastructure, or to open-source the software.

\subsection{Interface Design}

If the Internet generation is guilty of a short attention span, then the Facebook\cite{facebook}
generation is even more so. Often for good reason. There simply isn't enough time in the day. Most
of us are overloaded and stressed-out trying to manage our busy lives. We mine and sift through
mountains of information every day. We have to make every second of every minute count. Human cycles
are valuable and most certainly more so than \gls{cpu} cycles! We were acutely aware of these
factors when designing our \twirly{} \gls{ui}. Our barrier to entry has to be kept low.

We put new users on a fast track that allows them to get started quickly. They can sign-in using
their Google\cite{google} account, so there is no need to create and maintain yet another set of
online credentials. Any non-essential information has been removed from the sign-up process and
deferred to a preferences screen. The \gls{ui} is free of clutter and unnecessary
distractions. There are no gimmicks, pop-ups or excessive use of colour. The layout and workflows
follow the principle of least surprise, so that they feel familiar and intuitive to professional
traders. We work hard to retain a simple, consistent and functional interface that works well on a
range of devices from mobile to desktop.

\section{Architecture}

\twirly{} is an electronic \gls{order-book} that provides a ``\gls{restful}'' \gls{api} for querying
reference-data, \gls{market}-data, and managing \glspl{order}. Twirly's\cite{twirly} software
architecture is designed to achieve the following goals:

\begin{itemize}
\item clean and simple user interface;
\item mobile, \gls{web} and desktop equality;
\item language- and platform-agnostic \gls{api};
\item scalable \gls{microservice} architecture;
\item elastic storage and compute;
\item efficient resource consumption;
\item highly available, reliable and secure;
\item low maintenance and low \gls{tco};
\item use of open standards and technologies.
\end{itemize}

A \Gls{restful} \gls{web} architecture was chosen because it is scalable and equally well suited to
mobile, \gls{web} and desktop clients. Its generality makes it suitable for retail and wholesale
trading applications, across \gls{asset}-class and product-type. It can be deployed to the
\gls{cloud} or on dedicated infrastructure.

The following diagram shows how the facets of the \gls{restful} \gls{api} map to internal
\glspl{servlet}, along with the \gls{http} methods and resources supported by those \glspl{servlet}:

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{serv.eps}
\caption{Restful API}
\end{figure}

The project was originally started as a \gls{poc} for a low-latency \gls{matching engine}. \scltd{}
was formed to take ownership of the project and put the company on a commercial footing. The current
development phase is being funded by revenue generated from consultancy by \scltd{}.

\subsection{Reference Data}

The following table summarises the \gls{restful} \gls{api} for querying reference-data:

\vspace{5mm}
\begin{tabular}{ll}
\multicolumn{2}{c}{Synopsis}\\
Method&Resource\\
\hline
GET&\texttt{/api/rec/}\\
GET&\texttt{/api/rec/asset/[mnem]}\\
GET&\texttt{/api/rec/contr/[mnem]}\\
GET&\texttt{/api/rec/market/[mnem]}\\
GET&\texttt{/api/rec/trader/[mnem]}\\
\end{tabular}
\vspace{5mm}

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{rec.eps}
\caption{Record Structures}
\end{figure}

\subsection{Market Data}

The following table summarises the \gls{restful} \gls{api} for querying \gls{market}-data:

\vspace{5mm}
\begin{tabular}{ll}
\multicolumn{2}{c}{Synopsis}\\
Method&Resource\\
\hline
GET&\texttt{/api/view/[market]}\\
\end{tabular}
\vspace{5mm}

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{view.eps}
\caption{View Structures}
\end{figure}

\subsection{Order Management}

\vspace{5mm}
\begin{tabular}{ll|l}
\multicolumn{2}{c}{Rest API}&\multicolumn{1}{c}{Fix API}\\
Method&Resource&Message\\
\hline
GET&\texttt{/api/sess/}\\
GET&\texttt{/api/sess/order/[market]/[id]}\\
GET&\texttt{/api/sess/trade/[market]/[id]}\\
GET&\texttt{/api/sess/posn/[contr]/[settlDate]}\\
DELETE&\texttt{/api/sess/order/<market>/<id>}\\
DELETE&\texttt{/api/sess/trade/<market>/<id>}\\
POST&\texttt{/api/sess/order/<market>/}&NewOrderSingle\\
PUT&\texttt{/api/sess/order/<market>/<id>}\\
\end{tabular}
\vspace{5mm}

\subsubsection{Executions}

\vspace{5mm}
\begin{tabular}{ll|ll|ll}
\multicolumn{2}{c}{Rest API}&\multicolumn{2}{c}{Fix API}\\
Name&Type&Tag&Field&Req'd&Description\\
\hline
Id&Long&17&ExecId&Y&-\\
OrderId&Long&37&OrderId&Y&-\\
Trader&String&1&Account&Y&-\\
Market&String&55&Symbol&Y&-\\
Contr&String&20000&Contract&Y&-\\
SettlDay&Int&64&FutSettDate&Y&-\\
Ref&String&11&ClOrdId&Y&-\\
State&State&150&ExecType&Y&-\\
-&-&39&OrdStatus&Y&-\\
Action&Enum&54&Side&Y&``Buy'' or ``Sell''\\
-&-&40&OrdType&Y&Always ``LIMIT''\\
Ticks&Long&44&Price&Y&Price in ticks\\
Lots&Long&38&OrderQty&Y&Quantity in lots\\
Resd&Long&151&LeavesQty&Y&-\\
Exec&Long&14&CumQty&Y&-\\
Cost&Long&20001&Cost&Y&-\\
-&-&6&AvgPx&Y&-\\
LastTicks&Long&31&LastPx&C&-\\
LastLots&Long&32&LastQty&C&-\\
MinLots&Long&110&MinQty&Y&-\\
MatchId&Long&20002&MatchId&C&-\\
Role&Role&851&LastLiquidityInd&C&-\\
Cpty&String&375&ContraBroker&C&-\\
Created&Long&60&TransactTime&Y&-\\
\end{tabular}
\vspace{5mm}

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{instruct.eps}
\caption{Order Structures}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{state.eps}
\caption{Order Workflow}
\end{figure}

\subsubsection{Order Placement}

\vspace{5mm}
\begin{tabular}{ll|ll|ll}
\multicolumn{2}{c}{Rest API}&\multicolumn{2}{c}{Fix API}\\
Name&Type&Tag&Field&Req'd&Description\\
\hline
Market&String&55&Symbol&Y&Market mnemonic\\
Ref&String&11&ClOrdId&Y&Client reference\\
Action&Enum&54&Side&Y&``Buy'' or ``Sell''\\
-&-&40&OrdType&Y&Always ``LIMIT''\\
Ticks&Long&44&Price&Y&Price in ticks\\
Lots&Long&38&OrderQty&Y&Quantity in lots\\
MinLots&Long&110&MinQty&Y&Minimum quantity in lots\\
-&-&60&TransactTime&Y&Current time\\
\end{tabular}
\vspace{5mm}

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{neworder.eps}
\caption{New Order Dialog}
\end{figure}

\subsubsection{Order Revision}

\vspace{5mm}
\begin{tabular}{ll|ll|ll}
\multicolumn{2}{c}{Rest API}&\multicolumn{2}{c}{Fix API}\\
Name&Type&Tag&Field&Req'd&Description\\
\hline
Market&String&55&Symbol&Y&Market mnemonic\\
-&-&11&ClOrdId&Y&Client reference\\
Id&Long&37&OrderId&Y&Order identifier\\
-&-&41&OrigClOrdId&Y&Original client reference\\
-&-&54&Side&Y&Always ``Undisclosed''\\
-&-&40&OrdType&Y&Always ``LIMIT''\\
Lots&Long&38&OrderQty&Y&Quantity in lots\\
-&-&60&TransactTime&Y&Current time\\
\end{tabular}
\vspace{5mm}

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{reviseorder.eps}
\caption{Revise Order Dialog}
\end{figure}

\subsubsection{Order Cancellation}

\vspace{5mm}
\begin{tabular}{ll|ll|ll}
\multicolumn{2}{c}{Rest API}&\multicolumn{2}{c}{Fix API}\\
Name&Type&Tag&Field&Req'd&Description\\
\hline
Market&String&55&Symbol&Y&Market mnemonic\\
-&-&11&ClOrdId&Y&Client reference\\
Id&Long&37&OrderId&Y&Order identifier\\
-&-&41&OrigClOrdId&Y&Original client reference\\
-&-&54&Side&Y&Always ``Undisclosed''\\
-&-&38&OrderQty&Y&Always zero. Ignored by server-side\\
-&-&60&TransactTime&Y&Current time\\
\end{tabular}
\vspace{5mm}

\subsection{Administration}

\vspace{5mm}
\begin{tabular}{ll}
\multicolumn{2}{c}{Synopsis}\\
Method&Resource\\
\hline
POST&\texttt{/api/rec/market/}\\
POST&\texttt{/api/rec/trader/}\\
\end{tabular}
\vspace{5mm}

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{newmarket.eps}
\caption{New Market Dialog}
\end{figure}

To create a new \gls{market}, submit an \gls{http} post request to the \texttt{/api/rec/market/}
resource with the following \gls{json} content:

{\tt\small
\begin{verbatim}
{"mnem":"EURUSD.MAR15","display":"EURUSD March 15","contr":"EURUSD",
 "settlDate":20150320,"expiryDate":20150318}
\end{verbatim}
}

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{newtrader.eps}
\caption{New Trader Dialog}
\end{figure}

To create a new trader, submit an \gls{http} post request to the \texttt{/api/rec/trader/} resource
with the following \gls{json} content:

{\tt\small
\begin{verbatim}
{"mnem":"EURUSD.MAR15","display":"EURUSD March 15",
 "email":"mark.aylett@swirlycloud.com"}
\end{verbatim}
}

\begin{appendices}

\section{Business Plan}

\subsection{Executive Summary}

\subsection{Business Summary}
\subsubsection{Mission Statement}
\subsubsection{Company Structure}
\subsubsection{Management Structure}
\subsubsection{Products And Services}

\subsection{Market Summary}
\subsubsection{Industry Analysis}
\subsubsection{Market Analysis}
\subsubsection{Competitor Analysis}
\subsubsection{SWOT Analysis}

\subsection{Strategic Summary}
\subsubsection{Development Plan}
\subsubsection{Marketing Plan}
\subsubsection{Operations Plan}
\subsubsection{Financial Plan}
  
\section{Contributing}

The \twirly{} project is available on GitHub\cite{github} for members of the \scorg{} organisation.

\subsection{Getting Started}

\scorg{} members can clone the \twirly{} repository as follows:

\lstset{language=sh}
\begin{lstlisting}
$ git clone git@github.com:swirlycloud/twirlyj.git 
\end{lstlisting}

Developers should, however, work on their own fork of the repository and submit pull requests to
have their patches reviewed and possibly merged onto the \texttt{master} branch.

Once you have a local copy of the repository checked-out, add a remote upstream repository so that
you can keep your fork in sync:

\lstset{language=sh}
\begin{lstlisting}
$ git remote add upstream git@github.com:swirlycloud/twirlyj.git
\end{lstlisting}

You can build the source code and run the unit tests using Gradle\cite{gradle} as follows:

\lstset{language=sh}
\begin{lstlisting}
$ gradle build
\end{lstlisting}

The application can then be tested locally by running the following command and browsing to
\url{http://localhost:8080/}:

\lstset{language=sh}
\begin{lstlisting}
$ gradle appengineRun
\end{lstlisting}

Eclipse\cite{eclipse} project files can also be generated using the following command:

\lstset{language=sh}
\begin{lstlisting}
$ gradle eclipse
\end{lstlisting}

\subsection{Syncing Your Fork}

You'll first need to fetch branches and their commits from the upstream repository:

\lstset{language=sh}
\begin{lstlisting}
$ git fetch upstream
\end{lstlisting}

Commits from the upstream's \texttt{master} branch will now be stored in a local branch called
\texttt{upstream/master}. Check out your fork's local \texttt{master} branch and rebase from the
\texttt{upstream/master} branch:

\lstset{language=sh}
\begin{lstlisting}
$ git checkout master
$ git rebase upstream/master
\end{lstlisting}

Your local fork's \texttt{master} branch should now be in sync with the upstream
repository. Finally, you can push your local \texttt{master} branch to origin \texttt{master}, so
that origin \texttt{master} is also in sync with the upstream repository:

\lstset{language=sh}
\begin{lstlisting}
$ git push origin master
\end{lstlisting}

\section{Conversions}

\subsection{Rounding}

The \texttt{roundHalfAway} function is defined as follows:

\[r(x) = \left\{\begin{array}{ll}
  0 & \mbox{if $x = 0$};\\
  \ceil{x-0.5} & \mbox{if $x < 0$};\\
  \floor{x+0.5} & \mbox{if $x > 0$}.\\
\end{array}\right.
\]

\end{appendices}

\newpage
\addcontentsline{toc}{section}{References}
\bibliographystyle{plain}
\bibliography{twirly}
\printglossaries

\end{document}
